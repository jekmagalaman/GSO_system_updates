{% extends "requestor/requestor_base_dashboard.html" %}

{% block title %}Request History{% endblock %}

{% block main_content %}
<main class="main-content">
  <div class="request-container">
    <div class="request-header">
      <h2 class="request-title">REQUEST HISTORY</h2>
    </div>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Job No.</th>
            <th>Requestor Name</th>
            <th>Unit</th>
            <th>Request Date</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          {% if request_history %}
            {% for req in request_history %}
            <tr>
              <td>{{ req.id }}</td>
              <td>{{ req.requestor.get_full_name|default:req.requestor.username }}</td>
              <td>{{ req.get_unit_display }}</td>
              <td>{{ req.created_at|date:"Y-m-d" }}</td>
              <td>
                {% if req.status == "Pending" %}
                  <span class="status-badge status-pending">● Pending</span>
                {% elif req.status == "Approved" %}
                  <span class="status-badge status-approved">● Approved</span>
                {% elif req.status == "In Progress" %}
                  <span class="status-badge status-inprogress">● In Progress</span>
                {% elif req.status == "Done for Review" %}
                  <span class="status-badge status-doneforreview">● Done for Review</span>
                {% elif req.status == "Completed" %}
                  <span class="status-badge status-completed">● Completed</span>
                {% elif req.status == "Cancelled" %}
                  <span class="status-badge status-cancelled">● Cancelled</span>
                {% else %}
                  <span class="status-badge">{{ req.status }}</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-sm btn-primary"
                  onclick="openModal(
                    '{{ req.id }}',
                    '{{ req.get_unit_display }}',
                    '{{ req.created_at|date:'Y-m-d' }}',
                    '{{ req.status }}',
                    '{{ req.description|escapejs }}',
                    '{% for p in req.assigned_personnel.all %}{{ p.get_full_name }}{% if not forloop.last %}, {% endif %}{% endfor %}'
                  )">
                  View
                </button>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center">No requests found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</main>
{% endblock %}
